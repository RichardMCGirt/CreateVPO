<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Product Portal â€” Select Items, Add Labor</title>
  <link rel="stylesheet" href="style.css" />
    <link rel="stylesheet" href="loading.css" />
<script src="app-config.js"></script>

  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
</head>
<body>

  <!-- Cart button (fixed, top-right) -->
  <button id="cartFab" class="cart-fab" aria-label="Open cart">
    <span class="cart-emoji" aria-hidden="true">ðŸ›’</span>
    <span id="cartCountBadge" class="badge">0</span>
  </button>

 <h1 class="page-title">VPO</h1>

  <!-- Controls -->
  <div id="controls" class="card">
    <input id="searchInput" type="search" placeholder="Search by SKU or Descriptionâ€¦" aria-label="Search by SKU or description" disabled />
    <select id="vendorFilter" aria-label="Filter by vendor" disabled>
      <option value="">All vendors</option>
    </select>
    <select id="categoryFilter" aria-label="Filter by category" disabled>
      <option value="">All categories</option>
    </select>
    <button id="clearFilters" class="btn" disabled>Clear</button>
  <select id="appModeSelect" style="margin:8px 0;">
  <option value="vpo">VPO</option>
  <option value="fillin">Fill-In</option>
</select>
</div>
<!-- Hidden-until-filter hint -->
<p id="bg-hint" style="display:block;margin:10px 0;color:#555;font-style:italic;">
</p>
<div class="status-row" id="dataStatusRow" aria-live="polite" aria-atomic="true">
      <span id="dataStatus" class="status-pill" data-state="idle">Not loaded</span>
      <button id="refreshData" class="btn" type="button">Refresh</button>
    </div>

</div>
<div class="status-row" id="dataStatusRow" aria-live="polite" aria-atomic="true">
  <span id="dataStatus" class="status-pill" data-state="idle"></span>
  <span id="fetch-count" class="count-badge" style="margin-left:8px;"></span>
</div>

  <!-- Category chips (mobile-friendly quick filter) -->
  <div id="categoryChips" class="chips scroller hidden" aria-label="Quick category filters"></div>
  
  </section>

<!-- Virtualized table (fast for 10k+ rows) -->
<div id="table-viewport" aria-label="Products table" style="display:none;">
  <div class="vhead">
    <div>Vendor</div><div>SKU</div><div>UOM</div><div>Description</div>
   <div>QTY</div>
  </div>
  <div id="table-spacer"></div>
</div>

<!-- Toast -->
  <div id="toast" role="status" aria-live="polite">Done</div>

<!-- Loading overlay -->
<div id="loadingBarOverlay" role="status" aria-live="polite" style="display:none;">
  <div class="loading-panel" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0">
    <div id="loadingBarLabel" class="loading-label">Startingâ€¦</div>
    <div class="loading-track">
      <div id="loadingBar" class="loading-fill" style="width:5%"></div>
    </div>
    <div id="loadingBarMeta" class="loading-meta"></div>
  </div>
</div>

<div id="gentleModeRow" class="row-gap" style="margin:6px 0 10px 0; display:none;">
  <label style="display:inline-flex;align-items:center;gap:8px;font-size:0.9rem;">
    <input id="gentleMode" type="checkbox" checked /> Gentle mode (prevent 429s)
  </label>
</div>

<!-- ===== Description Sheet (mobile/desktop) ===== -->
<div id="desc-sheet" hidden>
  <div class="ds-backdrop"></div>
  <div class="ds-panel" role="dialog" aria-modal="true" aria-labelledby="ds-title">
    <div class="ds-header">
      <strong id="ds-title">Item</strong>
      <button id="ds-close" class="btn ds-close" aria-label="Close">âœ•</button>
    </div>

    <div class="ds-body">
      <div class="ds-row"><span class="k">Vendor</span><span class="v" id="ds-vendor">â€”</span></div>
      <div class="ds-row"><span class="k">SKU</span><span class="v" id="ds-sku">â€”</span></div>
      <div class="ds-row"><span class="k">UOM</span><span class="v" id="ds-uom">â€”</span></div>
      <div class="ds-row"><span class="k">Helper</span><span class="v" id="ds-helper">â€”</span></div>
      <div class="ds-row"><span class="k">Multiple</span><span class="v" id="ds-multiple">â€”</span></div>
      <div class="ds-row big"><span class="k">Description</span><span class="v" id="ds-desc">â€”</span></div>
      <div class="ds-row"><span class="k">Unit Price</span><span class="v" id="ds-price">â€”</span></div>
    </div>

    <form id="ds-form" class="ds-actions" autocomplete="off">
      <input id="ds-qty"
             type="text"
             inputmode="numeric"
             pattern="[0-9]*"
             aria-label="Quantity"
             placeholder="Qty"
             value="0"
             minlength="1"
             class="ds-qty">
      <button id="ds-add" type="submit" class="btn ds-add">Add</button>
    </form>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/luxon@3/build/global/luxon.min.js"></script>

<script src="database.js"></script>
<link rel="stylesheet" href="theme.pro.css"> <!-- after -->

<script src="app-ui-gates.js"></script>


<script src="https://apis.google.com/js/api.js" onload="gapiLoaded()" async defer></script>
<script src="https://accounts.google.com/gsi/client" onload="gisLoaded()" async defer></script>

<script>
  (function () {
    try {
      if (window.APP) {
        document.title = (window.APP.uiTitle || "Portal") + " â€” Product & VPO Calculator";
        var h1 = document.querySelector(".page-title");
        if (h1) h1.textContent = window.APP.uiTitle || h1.textContent;
      }
    } catch {}
  })();
   (function(){
    // Prefer URL ?app=..., then localStorage, then default
    const qs = new URLSearchParams(location.search);
    const qsMode = (qs.get("app")||"").toLowerCase();
    const saved  = localStorage.getItem("vanir_app_mode") || "";
    const mode   = qsMode || saved || "vpo";
    const sel = document.getElementById("appModeSelect");
    if (sel) sel.value = mode;
    if (!qsMode && mode) {
      // if no ?app, apply data-app attribute so app-config can see it on first render
      document.documentElement.setAttribute("data-app", mode);
    }
    if (sel) sel.addEventListener("change", () => {
      const next = sel.value;
      localStorage.setItem("vanir_app_mode", next);
      const url = new URL(location.href);
      url.searchParams.set("app", next);
      location.href = url.toString(); // reload with explicit mode
    });
  })();
   (function(){
    var sel = document.getElementById("appModeSelect");
    if (!sel) return;
    // Initialize the dropdown to current mode
    try { sel.value = (window.APP_MODE || "vpo"); } catch {}
    // On change, persist and reload with ?app=
    sel.addEventListener("change", function(){
      if (typeof window.__setAppMode === "function") {
        window.__setAppMode(sel.value);
      } else {
        // fallback
        try { localStorage.setItem("vanir_app_mode", sel.value); } catch {}
        var url = new URL(location.href);
        url.searchParams.set("app", sel.value);
        location.href = url.toString();
      }
    }, { passive:true });
  })();
   (function(){
    var fab = document.getElementById("cartFab");
    if (!fab) return;
    fab.addEventListener("click", function(){
      var m = window.APP_MODE || "vpo";
      location.href = "cart.html?app=" + encodeURIComponent(m);
    });
  })();
</script>

</body>
</html>